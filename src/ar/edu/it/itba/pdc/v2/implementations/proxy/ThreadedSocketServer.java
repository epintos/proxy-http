package ar.edu.it.itba.pdc.v2.implementations.proxy;import java.io.IOException;import java.net.InetAddress;import java.net.ServerSocket;import java.net.Socket;import java.util.concurrent.ExecutorService;import java.util.concurrent.Executors;import org.apache.log4j.Level;import org.apache.log4j.Logger;import ar.edu.it.itba.pdc.v2.implementations.monitor.Monitor;import ar.edu.it.itba.pdc.v2.interfaces.Configurator;import ar.edu.it.itba.pdc.v2.interfaces.ConnectionHandler;import ar.edu.it.itba.pdc.v2.interfaces.ConnectionManager;public class ThreadedSocketServer implements Runnable {	private ServerSocket serverSocket;	private ConnectionHandler handler;	private ConnectionManager connectionManager;	private Configurator configurator;	private Monitor monitor;	public ThreadedSocketServer(final int port, final InetAddress interfaz,			final ConnectionHandler handler, Configurator configurator,			Monitor monitor, ConnectionManager connectionManager)			throws IOException {		init(new ServerSocket(port, 50, interfaz), handler, configurator,				monitor, connectionManager);	}	private void init(final ServerSocket s, final ConnectionHandler handler,			final Configurator configurator, final Monitor monitor,			final ConnectionManager connectionManager) {		if (s == null || handler == null || configurator == null				|| monitor == null) {			throw new IllegalArgumentException();		}		this.serverSocket = s;		this.handler = handler;		this.monitor = monitor;		this.connectionManager = connectionManager;		this.configurator = configurator;	}	public void run() {		Logger server = Logger.getLogger(this.getClass());		server.setLevel(Level.INFO);		server.info("Proxy listenting on port " + serverSocket.getLocalPort());		ExecutorService es = Executors.newFixedThreadPool(200);		while (true) {			Socket socket;			try {				socket = this.serverSocket.accept();				monitor.getDataStorage().addClientOpenConnection(1);				server.info("Connection accepted from "						+ socket.getInetAddress());				es.execute(new Attend(socket, handler, connectionManager,						configurator, monitor));			} catch (IOException e) {				return;			}		}	}}